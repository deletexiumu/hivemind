# HiveMind 数仓助手

## What This Is

一套面向 Hive+dbt 数仓研发的中文提示系统，提供"评审已有模型 / 设计新模型 / 生成导数 SQL / 定义指标口径 / 生成 DQ 规则 / 数据血缘分析"六大核心场景的标准化输出能力。基于 HiveMind 的多代理编排架构，通过可组合的提示包和规范上下文，实现可复用、可追溯、带质量门禁的数仓研发工作流。

## Core Value

用一套可组合的中文提示包，把 Hive+dbt 数仓的六类高频任务标准化为可复用、可追溯、带质量门禁的输出。

## Requirements

### Validated

<!-- 从现有 HiveMind 代码库继承的已验证能力 -->

- ✓ 多代理编排架构 — existing
- ✓ Markdown 提示与模板系统 — existing
- ✓ 基于文件的状态管理 — existing
- ✓ 工作流编排与检查点 — existing
- ✓ 跨平台安装（Claude Code / OpenCode） — existing

### Active

<!-- 本次重构的目标需求 -->

**核心场景**
- [ ] 评审已有模型：输入模型SQL/dbt配置/DDL，输出问题清单+严重级别+修复建议
- [ ] 设计新模型：输入业务事件/指标/粒度，输出星型设计+事实/维度定义+SCD策略+分层落点
- [ ] 生成导数SQL：输入取数口径/过滤/时间窗，输出符合规范的SQL+口径说明+性能提示
- [ ] 指标口径定义：规范化定义指标的计算逻辑、口径说明、版本管理
- [ ] 生成DQ规则：基于模型/表生成数据质量检测规则（dbt test 格式）
- [ ] 数据血缘分析：分析字段/表级血缘关系、变更影响评估

**规范与上下文**
- [ ] 中文规范文档：分层体系、命名规范、Kimball建模、指标口径、DQ标准、血缘定义
- [ ] 中英术语对照表：统一数仓术语用词
- [ ] Hive 平台上下文：分区策略、增量策略、dbt-hive 约束
- [ ] 可组合提示包：按场景/角色自动组装上下文

**工具化**
- [ ] 提示包构建工具：按任务选择注入 context
- [ ] 规格校验工具：检查模板字段完整性

### Out of Scope

- 实时数仓 — 本版本聚焦离线 T+1 场景
- 多语言支持 — 本版本仅支持中文
- 可视化血缘图 — 仅提供文本格式血缘分析
- 自动化 CI/CD 集成 — 本版本聚焦提示与规范
- 代码标识符中文化 — 代码层面保持英文

## Context

**技术选型：**
- 目标平台：多平台抽象，Hive 为主平台示例
- 建模方法论：Kimball 维度建模（星型/雪花模型）
- 核心工具链：dbt 为主（dbt-hive adapter）
- 数据时效：离线 T+1
- 分层体系：ODS/DWD/DWS/ADS（阿里/国内主流）

**治理优先级：**
1. 数据质量（DQ规则、异常检测、质量报告）
2. 指标口径（指标定义、计算逻辑、版本化）
3. 血缘追踪（数据来源、影响分析、变更传导）

**中文化范围：**
- 全部文档与提示中文
- 代码标识符保持英文
- 中英术语对照表

**现有架构保留：**
- 多代理编排：保留 HiveMind 的 Agent 层架构
- 提示模板系统：继承 Markdown 提示与 XML/YAML frontmatter
- 状态管理：保留基于文件的项目状态管理

## Constraints

- **平台**: Hive 数仓 + dbt-hive adapter — 需遵守 dbt-hive 的能力边界（不支持 ephemeral、snapshots）
- **时效**: 离线 T+1 — 增量策略基于分区回刷，默认 insert_overwrite
- **语言**: 中文输出 — 所有提示、规范、输出模板均为中文
- **依赖**: 零外部依赖 — 保持 HiveMind 的纯 Markdown/Node.js 架构

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| A+C 路线（规范+工具化） | 先标准化规范，再工具化提示系统 | — Pending |
| Kimball 维度建模 | 国内数仓主流方法论，与 ODS/DWD/DWS/ADS 分层体系匹配 | — Pending |
| dbt 为主工具链 | SQL 优先、版本控制友好、与 Hive 集成成熟 | — Pending |
| 6 个核心场景 | 覆盖数仓研发高频任务，聚焦而非大全 | — Pending |
| 代码标识符英文 | 避免编码问题，保持技术兼容性 | — Pending |

---
*Last updated: 2026-01-30 after initialization*
