---
phase: 08-tooling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/data-warehouse/prompts/scenarios/design-new-model/input-template.md
  - .claude/data-warehouse/prompts/scenarios/review-existing-model/input-template.md
  - .claude/data-warehouse/prompts/scenarios/generate-sql/input-template.md
  - .claude/data-warehouse/prompts/scenarios/define-metrics/input-template.md
  - .claude/data-warehouse/prompts/scenarios/generate-dq-rules/input-template.md
  - .claude/data-warehouse/prompts/scenarios/analyze-lineage/input-template.md
autonomous: true

must_haves:
  truths:
    - "每个场景都有 input-template.md 文件"
    - "输入模板包含结构化字段定义（用户填空形式）"
    - "输入模板包含示例输入"
    - "输入模板标注必填/推荐/可选字段"
    - "字段名与对应 JSON Schema 保持一致"
  artifacts:
    - path: ".claude/data-warehouse/prompts/scenarios/design-new-model/input-template.md"
      provides: "设计场景输入模板"
      contains: "business_event"
    - path: ".claude/data-warehouse/prompts/scenarios/review-existing-model/input-template.md"
      provides: "评审场景输入模板"
      contains: "model_code"
    - path: ".claude/data-warehouse/prompts/scenarios/generate-sql/input-template.md"
      provides: "SQL 生成场景输入模板"
      contains: "requirement"
    - path: ".claude/data-warehouse/prompts/scenarios/define-metrics/input-template.md"
      provides: "指标定义场景输入模板"
      contains: "metric_name"
    - path: ".claude/data-warehouse/prompts/scenarios/generate-dq-rules/input-template.md"
      provides: "DQ 规则生成场景输入模板"
      contains: "model_name"
    - path: ".claude/data-warehouse/prompts/scenarios/analyze-lineage/input-template.md"
      provides: "血缘分析场景输入模板"
      contains: "target_model"
  key_links:
    - from: "input-template.md"
      to: "prompt.md"
      via: "字段对应关系"
      pattern: "必填.*业务事件"
    - from: "input-template.md"
      to: "schemas/input/*.schema.json"
      via: "字段名必须一致"
      pattern: "business_event|grain|model_code|requirement|source_tables|metric_name|business_desc|model_name|columns|target_model"
---

<objective>
为每个场景创建标准化输入模板（TOOLS-03），让用户有明确的输入格式指引。

Purpose: 提供用户友好的输入模板，降低使用门槛，确保输入信息完整性。输入模板与 Schema 字段名保持一致，便于校验。

Output:
- 6 个 input-template.md 文件（每个场景一个）
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# 参考各场景的 prompt.md 和 output-template.md
@.claude/data-warehouse/prompts/scenarios/design-new-model/prompt.md
@.claude/data-warehouse/prompts/scenarios/review-existing-model/prompt.md
@.claude/data-warehouse/prompts/scenarios/generate-sql/prompt.md
@.claude/data-warehouse/prompts/scenarios/define-metrics/prompt.md
@.claude/data-warehouse/prompts/scenarios/generate-dq-rules/prompt.md
@.claude/data-warehouse/prompts/scenarios/analyze-lineage/prompt.md

# 参考现有案例的输入格式
@.claude/data-warehouse/prompts/scenarios/design-new-model/examples/e-commerce-order.md

# Schema 字段定义参考（Plan 01 创建，确保字段名一致）
# .claude/data-warehouse/schemas/input/design-new-model.schema.json
# .claude/data-warehouse/schemas/input/review-existing-model.schema.json
# .claude/data-warehouse/schemas/input/generate-sql.schema.json
# .claude/data-warehouse/schemas/input/define-metrics.schema.json
# .claude/data-warehouse/schemas/input/generate-dq-rules.schema.json
# .claude/data-warehouse/schemas/input/analyze-lineage.schema.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: 创建 design-new-model 和 review-existing-model 输入模板</name>
  <files>
    .claude/data-warehouse/prompts/scenarios/design-new-model/input-template.md
    .claude/data-warehouse/prompts/scenarios/review-existing-model/input-template.md
  </files>
  <action>
**重要：字段名必须与 Plan 08-01 创建的 JSON Schema 保持一致。**

参考 Schema 必填字段：
- design-new-model: business_event, grain
- review-existing-model: model_code

**design-new-model/input-template.md:**

创建包含以下结构的输入模板：
1. **frontmatter:** type: input-template, scenario: design-new-model, version: 1.0.0
2. **标题:** 设计新模型 - 输入模板
3. **字段定义表格:**
   - 字段名、说明、类型、必填/推荐/可选
   - business_event（必填）, grain（必填）, measures（推荐）, dimensions（可选）, source（可选）
4. **YAML 模板:**（用户可直接复制填写）
   ```yaml
   business_event: ""     # [必填] 业务事件名称
   grain: ""              # [必填] 粒度声明
   measures: []           # [推荐] 度量字段
   dimensions: []         # [可选] 维度清单
   source:                # [可选] 数据来源
     table: ""
     partition_col: ""
   ```
5. **示例输入:** 参考 e-commerce-order.md 案例
6. **常见错误提示:** 列出 2-3 个常见填写错误

**review-existing-model/input-template.md:**

创建包含以下结构的输入模板：
1. **frontmatter:** type: input-template, scenario: review-existing-model, version: 1.0.0
2. **标题:** 评审已有模型 - 输入模板
3. **字段定义表格:**
   - model_code（必填）- SQL 代码或 dbt 模型
   - dbt_config（推荐）- schema.yml 配置
   - layer_context（可选）- 分层信息
   - review_focus（可选）- 重点评审维度
4. **输入格式说明:** 支持直接粘贴 SQL 或提供文件路径
5. **示例输入:** 提供一个简单的 SQL 模型示例
6. **常见错误提示**
  </action>
  <verify>
    - 2 个 input-template.md 文件存在
    - 包含 frontmatter 和字段定义表格
    - 包含 YAML 模板和示例输入
    - 字段名与 Schema 一致（business_event, grain, model_code）
  </verify>
  <done>
    - design-new-model/input-template.md 定义了必填（business_event, grain）和可选字段
    - review-existing-model/input-template.md 定义了必填（model_code）和可选字段
    - 字段名与对应 JSON Schema 保持一致
  </done>
</task>

<task type="auto">
  <name>Task 2: 创建 generate-sql 和 define-metrics 输入模板</name>
  <files>
    .claude/data-warehouse/prompts/scenarios/generate-sql/input-template.md
    .claude/data-warehouse/prompts/scenarios/define-metrics/input-template.md
  </files>
  <action>
**重要：字段名必须与 Plan 08-01 创建的 JSON Schema 保持一致。**

参考 Schema 必填字段：
- generate-sql: requirement, source_tables
- define-metrics: metric_name, business_desc

**generate-sql/input-template.md:**

1. **frontmatter:** type: input-template, scenario: generate-sql, version: 1.0.0
2. **标题:** 生成 SQL - 输入模板
3. **字段定义:**
   - requirement（必填）- 取数需求描述
   - source_tables（必填）- 数据源表清单
   - time_window（推荐）- 时间窗口
   - filters（可选）- 过滤条件
   - aggregations（可选）- 聚合维度
   - scd2_handling（可选）- SCD2 维度处理方式
4. **YAML 模板**
5. **示例输入:** 参考 generate-sql/examples/simple-select.md
6. **性能提示:** 提醒用户提供分区信息

**define-metrics/input-template.md:**

1. **frontmatter:** type: input-template, scenario: define-metrics, version: 1.0.0
2. **标题:** 定义指标 - 输入模板
3. **字段定义:**
   - metric_name（必填）- 指标名称
   - business_desc（必填）- 业务描述
   - calculation_logic（推荐）- 计算逻辑草稿
   - grain（推荐）- 统计粒度（grain、时间字段、可切维度）
   - source_table（可选）- 数据来源表
   - metric_type（可选）- 指标类型（原子/派生/复合）
4. **YAML 模板**
5. **示例输入**
6. **Semantic Layer 提示:** 说明输出会生成 dbt Semantic Layer YAML
  </action>
  <verify>
    - 2 个 input-template.md 文件存在
    - generate-sql 包含 requirement 和 source_tables 必填字段
    - define-metrics 包含 metric_name 和 business_desc 必填字段
    - 字段名与 Schema 一致
  </verify>
  <done>
    - generate-sql/input-template.md 定义了 SQL 生成所需的输入字段
    - define-metrics/input-template.md 定义了指标定义所需的输入字段
    - 字段名与对应 JSON Schema 保持一致
  </done>
</task>

<task type="auto">
  <name>Task 3: 创建 generate-dq-rules 和 analyze-lineage 输入模板</name>
  <files>
    .claude/data-warehouse/prompts/scenarios/generate-dq-rules/input-template.md
    .claude/data-warehouse/prompts/scenarios/analyze-lineage/input-template.md
  </files>
  <action>
**重要：字段名必须与 Plan 08-01 创建的 JSON Schema 保持一致。**

参考 Schema 必填字段：
- generate-dq-rules: model_name, columns
- analyze-lineage: target_model

**generate-dq-rules/input-template.md:**

1. **frontmatter:** type: input-template, scenario: generate-dq-rules, version: 1.0.0
2. **标题:** 生成 DQ 规则 - 输入模板
3. **字段定义:**
   - model_name（必填）- 目标模型名称
   - columns（必填）- 字段清单（含类型）
   - layer（推荐）- 模型所在分层（ODS/DWD/DWS/ADS）
   - partition_col（推荐）- 分区列
   - scd2_fields（可选）- SCD2 相关字段
   - thresholds（可选）- 阈值配置
   - freshness（可选）- 新鲜度要求
4. **YAML 模板**
5. **示例输入:** 参考 generate-dq-rules/examples/fact-table-dq.md
6. **字段类型提示:** 说明字段后缀（_id, _amt, _cnt, _status）影响规则生成

**analyze-lineage/input-template.md:**

1. **frontmatter:** type: input-template, scenario: analyze-lineage, version: 1.0.0
2. **标题:** 分析血缘 - 输入模板
3. **字段定义:**
   - target_model（必填）- 目标模型名称或 SQL
   - analysis_mode（推荐）- 分析模式（table_level/column_level/impact_assessment）
   - change_description（可选，影响评估模式必填）- 变更描述
   - project_context（可选）- dbt 项目路径
4. **YAML 模板**
5. **示例输入**
6. **精度提示:** 说明复杂 SQL（窗口函数、递归 CTE）字段级血缘可能不精确
  </action>
  <verify>
    - 2 个 input-template.md 文件存在
    - generate-dq-rules 包含 model_name 和 columns 必填字段
    - analyze-lineage 包含 target_model 必填字段
    - 字段名与 Schema 一致
  </verify>
  <done>
    - generate-dq-rules/input-template.md 定义了 DQ 规则生成所需的输入字段
    - analyze-lineage/input-template.md 定义了血缘分析所需的输入字段
    - 字段名与对应 JSON Schema 保持一致
  </done>
</task>

</tasks>

<verification>
- 6 个场景目录都包含 input-template.md 文件
- 所有模板包含 frontmatter、字段定义、YAML 模板、示例、常见错误
- 字段名与对应的 JSON Schema 一致（使用 grep 验证）：
  ```bash
  # 验证 design-new-model 字段一致性
  grep -q "business_event" .claude/data-warehouse/prompts/scenarios/design-new-model/input-template.md
  grep -q "business_event" .claude/data-warehouse/schemas/input/design-new-model.schema.json
  # 类似验证其他场景...
  ```
</verification>

<success_criteria>
- [ ] 6 个 input-template.md 创建完成
- [ ] 每个模板明确标注必填/推荐/可选字段
- [ ] 每个模板包含可复制的 YAML 模板
- [ ] 每个模板包含至少一个完整示例
- [ ] 字段名与 Schema 定义保持一致（grep 验证通过）
</success_criteria>

<output>
After completion, create `.planning/phases/08-tooling/08-02-SUMMARY.md`
</output>
