---
type: scenario-support
scenario: analyze-lineage
document: impact-analysis-template
version: 1.0.0
token_budget: 700
---

# 变更影响评估报告模板

## 变更描述

```markdown
- **变更对象：** `{table_or_column}`
- **变更类型：** `{add|modify|delete|rename}`
- **影响类型（初判）：** `{Breaking|语义变更|仅新增}`
- **变更内容：** `{description}`
```

---

## 影响范围

### Level 1: 一级下游

```markdown
| 对象 | 类型 | 影响等级 | 影响类型 | 路径置信度 | 影响原因（路径摘要） | 处理建议 |
|------|------|----------|----------|------------|----------------------|----------|
| `{downstream_1}` | 表/字段 | 高/中/低 | Breaking/语义变更/仅新增 | A/B/C/D | `A → {downstream_1}` | 需重跑/需修改/需验证 |
```

### Level 2: 二级下游

```markdown
| 对象 | 类型 | 影响等级 | 影响类型 | 路径置信度 | 影响原因（路径摘要） | 处理建议 |
|------|------|----------|----------|------------|----------------------|----------|
| `{downstream_2}` | 表/字段 | 高/中/低 | ... | ... | `A → B → {downstream_2}` | ... |
```

### 末端影响（报表/应用）

```markdown
| 报表/应用 | 负责人 | 影响等级 | 影响类型 | 路径置信度 | 影响原因（路径摘要） | 处理建议 |
|-----------|--------|----------|----------|------------|----------------------|----------|
| `{report_1}` | `{owner}` | 高 | Breaking | B | `A → ... → {report_1}` | 通知业务方 + 回归验证 |
```

---

## 影响图谱

```mermaid
graph TD
    A["变更源: {changed_object}"]

    subgraph L1["一级下游"]
        B[{downstream_1}]
        C[{downstream_2}]
    end

    subgraph L2["二级下游"]
        D[{downstream_3}]
    end

    subgraph End["末端"]
        E[{report_1}]
    end

    A -->|"LOW·语义变更·B"| B
    A -->|"MEDIUM·语义变更·B"| C
    C -->|"HIGH·Breaking·C"| D
    D -->|"HIGH·Breaking·C"| E

    style A fill:#ff8a80
    style B fill:#c8e6c9
    style C fill:#c8e6c9
    style D fill:#ffecb3
    style E fill:#ffcc80
```

**边标签格式：** `"影响等级·影响类型·路径置信度"`

---

## 循环与截断说明

```markdown
- **循环检测：** `{detected|not_detected}`（若 detected，列出环路节点）
- **最大深度：** `{N}`（超过后截断并提示"未完全展开"）
- **最大节点数：** `{M}`（超过后按层级/影响等级优先保留）
```

---

## 处理清单

```markdown
- [ ] 重跑 `{table}`（分区范围：`{dt_range}`）
- [ ] 修改下游 SQL/模型（若影响类型为 Breaking）
- [ ] 通知 `{owner}`（高影响 + Breaking/语义变更）
- [ ] 回归验证关键指标/报表
```

---

## 影响类型处理矩阵

| 影响类型 | 定义 | 典型变更 | 默认建议动作 |
|----------|------|----------|--------------|
| **Breaking** | 下游不可直接运行 | 删列/改名/类型不兼容/改粒度 | 阻断发布；修改下游；全链路重跑；通知负责人 |
| **语义变更** | 可运行但口径变化 | 过滤条件/去重规则/指标定义变更 | 标记口径升级；重跑/回刷；关键报表回归 |
| **仅新增** | 不影响既有结果 | 新增列/新增表/新增可选指标 | 更新文档/血缘；下游按需接入 |

**合成规则：** 最终建议动作 = max(影响类型动作, 影响等级动作)

---

## 影响等级判定

| 等级 | 定义 | 触发条件 |
|------|------|----------|
| **高** | 关键业务受影响 | ADS 层表、报表、指标 |
| **中** | 中间层受影响 | DWS 层表、衍生指标 |
| **低** | 底层受影响 | DWD 层表、明细数据 |

---

## 节点颜色约定

| 类型 | 颜色代码 | 说明 |
|------|----------|------|
| 变更源 | `#ff8a80` | 红色（警告） |
| DWD 层 | `#c8e6c9` | 淡绿色 |
| DWS 层 | `#f3e5f5` | 淡紫色 |
| ADS 层 | `#ffecb3` | 淡橙色 |
| 末端报表 | `#ffcc80` | 橙色（关注） |

---

## 路径置信度传播

```markdown
**规则：** 路径置信度 = min(路径上所有边置信度)

**示例：**
- A (置信度 A) → B (置信度 B) → C → 路径置信度 = B
- A (置信度 A) → B (置信度 D) → C → 路径置信度 = D（需人工确认）

**D 级路径处理：**
- 显式标注"需人工确认"
- 列出不确定边的位置和原因
- 建议人工补充血缘信息
```
